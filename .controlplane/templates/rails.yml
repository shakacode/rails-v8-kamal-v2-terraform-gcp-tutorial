# Template setup of Rails server workload, roughly corresponding to a Heroku web dyno.
kind: workload
name: rails
spec:
  type: standard
  containers:
    - name: rails
      cpu: 300m
      memory: 512Mi
      env:
        - name: LOG_LEVEL
          value: info
      inheritEnv: true
      image: {{APP_IMAGE_LINK}}
      ports:
        - number: 3000
          protocol: http
          # Note: Keep as 'http' â€” Thruster handles HTTP/2 on the TLS frontend,
          # but the load balancer communicates with the container via HTTP/1.1
  defaultOptions:
    autoscaling:
      minScale: 1
      maxScale: 1
    capacityAI: false
  firewallConfig:
    external:
      inboundAllowCIDR:
        - 0.0.0.0/0
      outboundAllowCIDR:
        - 0.0.0.0/0
  identityLink: {{APP_IDENTITY_LINK}}
